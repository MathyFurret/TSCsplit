<!DOCTYPE html>
<html>
<head>
<title>TSCsplit by mathfreak231</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script>
//set up ajax so all requests will go to this one URL
$.ajaxSetup({
	url: "https://jsonp.afeld.me/?url=http://soniccenter.org/source/utilities/codebot.php"
});

//which games have which categories
var catIDs = new Array();
catIDs[0] = "";
catIDs[5] = "AHIEbcdfgklmn";
catIDs[124] = "ACHIEbdfgklmn";
catIDs[128] = "AHEbcdfgiklmn";
catIDs[6] = "AHIEGbcdfklmn";
catIDs[127] = "ACHIEbdfgklmn";
catIDs[10] = "AHIEbcdfgklmn";
catIDs[112] = "AHIEbcdfgklmn";
catIDs[7] = "ACHIGbdefklmn";
catIDs[8] = "AHIGbcdefklmn";
catIDs[106] = "AHIEbcdfgklmn";
catIDs[114] = "AHIbcdefgklmn";
catIDs[115] = "AHIEbcdfgklmn";
catIDs[13] = "AHIEbcdfgklmn";
catIDs[9] = "AHIbcdefgklmn";
catIDs[3] = "AHIDFGbceklmn";
catIDs[4] = "AHIDFGbceklmn";
catIDs[11] = "ABHEFcdgiklmn";
catIDs[25] = "AHIFbcdegklmn";
catIDs[28] = "AHIbcdefgklmn";
catIDs[30] = "AIFKbcdeghlmn";
catIDs[92] = "ABKcdefghilmn";
catIDs[86] = "AHFbcdegiklmn";
catIDs[87] = "AHIFbcdegklmn";
catIDs[94] = "AHIbcdefgklmn";
catIDs[107] = "AHIFbcdegklmn";
catIDs[111] = "ACBHIFdegklmn";
catIDs[125] = "AHbcdefgiklmn";
catIDs[14] = "AHIbcdefgklmn";
catIDs[15] = "AHIbcdefgklmn";
catIDs[16] = "AHIbcdefgklmn";
catIDs[17] = "AHIbcdefgklmn";
catIDs[20] = "AHIEbcdfgklmn";
catIDs[1] = "AHIEbcdfgklmn";
catIDs[2] = "AHIEFbcdgklmn";
catIDs[23] = "AHEFbcdgiklmn";
catIDs[24] = "ACHIEFbdgklmn";
catIDs[61] = "ACBHIFdegklmn";
catIDs[108] = "ABHIEFcdgklmn";
catIDs[113] = "AHEFbcdgiklmn";
catIDs[126] = "AHIEFbcdgklmn";
catIDs[18] = "Abcdefghiklmn";
catIDs[19] = "Abcdefghiklmn";
catIDs[12] = "Abcdefghiklmn";
catIDs[26] = "CDabefghiklmn";
catIDs[73] = "CDabefghiklmn";
catIDs[103] = "CDabefghiklmn";
catIDs[109] = "Cabdefghiklmn";
catIDs[118] = "CDabefghiklmn";
catIDs[116] = "Cabdefghiklmn";
catIDs[27] = "AHIFbcdegklmn";
catIDs[62] = "AHIFbcdegklmn";
catIDs[29] = "Abcdefghiklmn";
catIDs[22] = "Iabcdefghklmn";
catIDs[21] = "Abcdefghiklmn";

//update the categories when a game is chosen
function updateCategories() {
	var game = $(this).val();
	for (var i = 0; i <= catIDs[game].length; i++) {
		var charValue = catIDs[game].charCodeAt(i);
		if (charValue >= 65 && charValue <= 90)
		{
			charValue -= 64;
			$("select[name=category] option[value=" + charValue + "]").prop("disabled", false);
			$("select[name=category] option[value=" + charValue + "]").show();
		}
		else if (charValue >= 97 && charValue <= 122)
		{
			charValue -= 96;
			$("select[name=category] option[value=" + charValue + "]").prop("disabled", true);
			$("select[name=category] option[value=" + charValue + "]").hide();
		}
		if (game == 0)
		{
			$("select[name=category]").hide();
		}
		else
		{
			$("select[name=category]").show();
		}
		$("select[name=category]").val("0")
	}
}

//use TSC's IRC handler as an API to get stats
function fetchClass(){
	var username = $("input[name=user]").val();
	var game_id = $("select[name=game]").val();
	var cat_id = $("select[name=category]").val();
	var level_name = $("input[name=level_name]").val();
	var div_order = $("input[name=division_order]").val();
	
	var data = {
		choice: "21"
	};
	if (game_id !== "0") data['g'] = game_id;
	if (cat_id !== "0") data['c'] = cat_id;
	if (level_name !== "") data['ln'] = level_name;
	data['do'] = div_order;
	
	var search_results = $.ajax({
		data: data
	}).responseText;
	
	if (search_results.match(/Class \d+ is/)) { //result returned in the case of exactly 1 match
		var first_extract = search_results.match(/Class (\d+) is (.+?)\. (.+) is in \x02\x03\d{2}1st place\x03\x02 out of (\d+) on this chart with (.+)/);
		//class number, full level name, first place user, number of players, first place stat
		if (username.toLowerCase() === first_extract[3]) {
			console.log(first_extract[2] + " " + first_extract[3] + " 1/" + first_extract[4] + " " + first_extract[5]);
		} else {
			var get_user = $.ajax({
				data: {choice: "25", class: first_extract[1], name: username}
			}).responseText
		}
	}
}

$(document).ready(function() {
	$('select[name=game]').change(updateCategories);
	$('button.submit-button').click(fetchClass);
});

</script>
</head>
<body style="font-family:sans-serif;">
	<label for="user">Your username: </label><input type="text" name="user"><br>
	Search for a chart: <br>
	<label for="game">Game: </label><select name='game'>
		<option value='0' selected>Select a game...</option>
		<option value='5'>Sonic 1</option>
		<option value='124'>Sonic 1 2013</option>
		<option value='128'>Sonic 1 Genesis (GBA)</option>
		<option value='6'>Sonic 2</option>
		<option value='127'>Sonic 2 2013</option>
		<option value='10'>Sonic CD</option>
		<option value='112'>Sonic CD 2011</option>
		<option value='7'>Sonic 3</option>
		<option value='8'>Sonic & Knuckles</option>
		<option value='106'>Sonic 4: Episode I</option>
		<option value='114'>Sonic 4: Episode Metal</option>
		<option value='115'>Sonic 4: Episode II</option>
		<option value='13'>Knuckles Chaotix</option>
		<option value='9'>Sonic 3D Blast</option>
		<option value='3'>Sonic Adventure (DX)</option>
		<option value='4'>Sonic Adventure 2 (B)</option>
		<option value='11'>Sonic Heroes</option>
		<option value='25'>Shadow the Hedgehog</option>
		<option value='28'>Sonic The Hedgehog</option>
		<option value='30'>Sonic and the Secret Rings</option>
		<option value='92'>Sonic and the Black Knight</option>
		<option value='86'>Sonic Unleashed Wii-PS2</option>
		<option value='87'>Sonic Unleashed 360-PS3</option>
		<option value='94'>Sonic Unleashed DLC</option>
		<option value='107'>Sonic Colors Wii</option>
		<option value='111'>Sonic Generations</option>
		<option value='125'>Sonic Lost World</option>
		<option value='14'>Sonic 1 (GG)</option>
		<option value='15'>Sonic 2 (GG)</option>
		<option value='16'>Sonic Chaos</option>
		<option value='17'>Sonic Triple Trouble</option>
		<option value='20'>Sonic Pocket Adventure</option>
		<option value='1'>Sonic Advance</option>
		<option value='2'>Sonic Advance 2</option>
		<option value='23'>Sonic Advance 3</option>
		<option value='24'>Sonic Rush</option>
		<option value='61'>Sonic Rush Adventure</option>
		<option value='108'>Sonic Colors DS</option>
		<option value='113'>Sonic Generations 3DS</option>
		<option value='126'>Sonic Lost World 3DS</option>
		<option value='18'>Sonic Drift</option>
		<option value='19'>Sonic Drift 2</option>
		<option value='12'>Sonic R</option>
		<option value='26'>Sonic Riders</option>
		<option value='73'>Sonic Riders: Zero Gravity</option>
		<option value='103'>Sonic & Sega All-Stars Racing</option>
		<option value='109'>Sonic & Sega All-Stars Racing DS</option>
		<option value='118'>Sonic & All-Stars Racing Transformed</option>
		<option value='116'>Sonic Free Riders</option>
		<option value='27'>Sonic Rivals</option>
		<option value='62'>Sonic Rivals 2</option>
		<option value='29'>Sonic the Fighters</option>
		<option value='22'>Sonic Battle</option>
		<option value='21'>Sonic Jam</option>
	</select><br>
	<label for="category">Category: </label><select name="category" style="display:none;">
		<option value="0">Select a category...</option>
		<option value='1'>Times</option>
		<option value='3'>Time Attack</option>
		<option value='12'>Uber Times</option>
		<option value='2'>Extra</option>
		<option value='8'>Rings</option>
		<option value='9'>Scores</option>
		<option value='4'>Races</option>
		<option value='5'>Special</option>
		<option value='6'>Bosses</option>
		<option value='11'>Ring Chains</option>
		<option value='7'>Freestyle</option>
	</select><br>
	<label for="level_name">Level name: </label><input type="text" name="level_name"><br>
	<label for="division_order">Division number: </label><input type="number" name="division_order" value="1" min="1"><br>
	<input type="reset"><input type="button" value="Go!" class="submit-button"><br>
	<div class="output"></div>
</body>
</html>
